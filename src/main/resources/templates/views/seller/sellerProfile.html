<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">

<head>
    <div th:replace="~{flagment/seller/sellerHead :: sellerHeadFragment}"></div>
    <style>
        .product-name {
            max-width: 180px; /* Đặt giới hạn chiều rộng, ví dụ 200px */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

    </style>
</head>

<body class="hold-transition skin-blue sidebar-mini" ng-app="app" ng-controller="myController">
<div class="wrapper">
    <!-- Preloader -->
    <div class="preloader flex-column justify-content-center align-items-center">
        <img class="animation__wobble" src="/img/banner/logotitle.png" alt="AdminLTELogo" height="60" width="60">
    </div>

    <div th:replace="~{flagment/seller/sellerHeader :: sellerHeaderFragment}"></div>
    <div th:replace="~{flagment/seller/sellerMainSidebar :: sellerMainSidebarFragment}"></div>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>Thông tin người dùng</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
                            <li class="breadcrumb-item active">Người dùng</li>
                        </ol>
                    </div>
                </div>
            </div>
            <!-- /.container-fluid -->
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-3">

                        <!-- Profile Image -->
                        <div class="card card-primary card-outline">
                            <div class="card-body box-profile">
                                <div class="text-center"
                                     style="position: relative; width: 100px;height: 100px;overflow: hidden;left: 50%;transform: translateX(-50%);">
                                    <label for="avatarInput">
                                        <img class="profile-user-img img-fluid img-circle" id="avatar"
                                         style="border: 3px solid #adb5bd;margin: 0 auto;padding: 3px;object-fit: cover;position: absolute;top: 0;left: 0;width: 100%;height: 100%;"
                                         src="/img/account/{{data.seller.avatar}}"
                                         alt="User profile picture" >
                                    </label>
                                     
                                         
                                </div>

                                <h3 class="profile-username text-center">{{ data.seller.fullname }}</h3>

                                <p class="text-muted text-center">{{ data.seller.username }}</p>

                                <ul class="list-group list-group-unbordered mb-3">
                                    <li class="list-group-item"><b>Số lượng hóa đơn</b> <a
                                            class="float-right">{{ data.amountOrder }}</a></li>
                                    <li class="list-group-item"><b>Người theo dõi</b> <a
                                            class="float-right">{{ data.amountFollow }}</a></li>
                                    <li class="list-group-item"><b>Tổng số sản phẩm</b> <a
                                            class="float-right">{{ data.amountProduct }}</a></li>
                                    <li class="list-group-item"><b>Sản phẩm đã bán</b> <a
                                            class="float-right">{{ data.amountProductSell }}</a></li>
                                </ul>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-9">
                        <div class="card">
                            <div class="card-header p-2">
                                <ul class="nav nav-pills">
                                    <li class="nav-item"><a class="nav-link active" href="#info-account"
                                        data-toggle="tab">Hồ sơ</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#product"
                                                            data-toggle="tab">Sản phẩm</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#timeline"
                                                            data-toggle="tab">Nhật ký</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#infomation"
                                                            data-toggle="tab">Thông tin</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#noti"
                                                            data-toggle="tab">Thông báo</a></li>
                                </ul>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div class="tab-content">
                                    <div class="active tab-pane" id="info-account">
                                        <!-- Post -->
                                        <form class="mt-4 form-horizontal" method="post"
												enctype="multipart/form-data" action="/profile/update">
												<div class="mb-3 bg-white rounded px-2">
													<input type="text" id="inputFullname" placeholder="Fullname"
														pattern="[a-zA-ZÀ-ỹ ]+" title="Name does not contain number"
														required class="form-control border-1 p-0 ps-2" name="fullname"
														th:value="${session.user.fullname}" />
												</div>

												<div class="input-group mb-3 bg-white rounded px-2">
													<input type="email" id="inputEmail"
														th:value="${session.user.email == null ? '' : session.user.email}"
														placeholder="Email chưa được đăng ký..."
														pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" maxlength="50"
														minlength="5" required class="form-control border-1 p-0 ps-2"
														name="email" disabled /> <span class="input-group-append">
														<button type="button" class="btn btn-info" data-toggle="modal"
															data-target="#ModalVerifyEmail">
															<i class="fas fa-edit"></i>
														</button>
													</span>
												</div>
												<!-- The Modal -->
												<div class="modal fade" id="ModalVerifyEmail">
													<div class="modal-dialog">
														<div class="modal-content">
															<!-- Modal Header -->
															<div class="modal-header">
																<h4 class="modal-title">Xác thực</h4>
																<button type="button" class="close"
																	data-dismiss="modal">
																	&times;</button>
															</div>

															<!-- Modal body -->
															<div class="modal-body">
																<div class="icon-security text-center mb-4">
																	<img class="img-fluid img-circle"
																		src="img/banner/security.png" alt="icon"
																		style="width: 80px" />
																</div>
																<div class="by-verify text-center mb-4">
																	<a
																		th:href="${session.user.email != null} ? @{/profile/verify/email} : @{/profile/change-email}"><label
																			class="btn btn-danger font-weight-normal">
																			Xác
																			minh bằng mã OTP gửi qua Email </label> </a>
																</div>
															</div>

														</div>
													</div>
												</div>

												<div class="input-group mb-3 bg-white rounded px-2">
													<input type="text" id="inputPhone"
														th:value="${session.user.phone == null ? '' : session.user.phone}"
														placeholder="Số điện thoại chưa được đăng ký..." pattern="[0-9()+-]*" maxlength="15"
														minlength="5" required class="form-control border-1 p-0 ps-2"
														name="phone" disabled /> <span class="input-group-append">
														<button type="button" class="btn btn-info" data-toggle="modal"
															data-target="#ModalVerifyPhone">
															<i class="fas fa-edit"></i>
														</button>
													</span>
												</div>

												<!-- The Modal -->
												<div class="modal fade" id="ModalVerifyPhone">
													<div class="modal-dialog">
														<div class="modal-content">
															<!-- Modal Header -->
															<div class="modal-header">
																<h4 class="modal-title">Xác thực</h4>
																<button type="button" class="close"
																	data-dismiss="modal">
																	&times;</button>
															</div>

															<!-- Modal body -->
															<div class="modal-body">
																<div class="icon-security text-center mb-4">
																	<img class="img-fluid img-circle"
																		src="img/banner/security.png" alt="icon"
																		style="width: 80px" />
																</div>
																<div class="by-verify text-center mb-4">
																	<a
																		th:href="${session.user.phone != null} ? @{/profile/verify/phone} : @{/profile/change-phone}"><label
																			class="btn btn-danger font-weight-normal">
																			Xác
																			minh bằng mã OTP gửi qua số điện thoại
																		</label> </a>
																</div>
															</div>

															<!-- Modal footer -->
														</div>
													</div>
												</div>
												<input type="file" id="avatarInput" style="display: none"
													name="avatarInput" /> <input type="hidden" name="avatar"
													id="avatar-hide" th:value="${session.user.avatar}" />

												<div class="mb-3 bg-white rounded px-2">
													<div class="form-group">
														<select name="gender" id="gender" class="form-control">
															<option selected="selected" disabled="disabled"
																value="null">Giới tính</option>
															<option value="Nam"
																th:selected="${session.user.gender == 'Nam'}">Nam
															</option>
															<option value="Nữ"
																th:selected="${session.user.gender == 'Nữ'}">Nữ</option>
															<option value="Other"
																th:selected="${session.user.gender == 'Other'}">Khác
															</option>
														</select>
													</div>
													<!--SOME INPUT RIGHT HERE -->
												</div>

												<div class="row">
													<div class="form-signup col-6">
														<div class="mb-3 bg-white rounded px-2">
															<button type="submit"
																class="form-control btn btn-success mt-3">Lưu</button>
														</div>
													</div>
													<div class="form-signup col-6">
														<div class="mb-3 rounded px-2">
															<a href="/verify-password"
																class="form-control text-white btn btn-success mt-3">
																Đổi mật khẩu </a>
														</div>
													</div>
												</div>
											</form>
                                        <!-- /.post -->

                                    </div>
                                    <div class="tab-pane" id="product">
                                        <!-- Post -->
                                        <div class="row">
                                            <div class="col-3" ng-repeat="product in products">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <img ng-src="{{ product.nameImageProduct }}"
                                                             alt="Product Image"
                                                             class="img-fluid rounded mx-auto d-block"
                                                             style="height: 200px;">
                                                    </div>
                                                    <div class="card-footer bg-white">
                                                        <h5 class="card-title product-name fs-5">{{ product.name }}</h5>
                                                        <br>
                                                        <div class="text-center">
                                                            <b class="text-danger"
                                                               ng-if="product.price == product.priceSale">{{
                                                                product.price }}<u class="text-danger">đ</u></b>
                                                            <del class="text-secondary"
                                                                 ng-if="product.price !== product.priceSale">{{
                                                                product.price }}<u class="text-secondary">đ</u></del>
                                                            <b class="text-danger"
                                                               ng-if="product.price !== product.priceSale">{{
                                                                product.priceSale }}<u class="text-danger">đ</u></b>
                                                        </div>
                                                        <div class="text-center">
                                                            <b class="text-info">Đã bán {{ product.soldCount }}</b>
                                                            <span>|</span>
                                                            <span>Còn lại {{ product.quantity }}</span>
                                                        </div>
                                                        <h5 class="text-center text-success" ng-if="product.active">Đang
                                                            được bán</h5>
                                                        <h5 class="text-center text-danger" ng-if="!product.active">Chưa
                                                            được bán</h5>
                                                        <div class="text-center">
                                                            <button class="btn btn-primary"
                                                                    ng-click="productDetail(product.id)">Xem
                                                            </button>
                                                            <button class="btn btn-primary"
                                                                    ng-click="editProduct(product.id)">Sửa
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.post -->

                                    </div>
                                    <!-- /.tab-pane -->
                                    <div class="tab-pane" id="timeline">
                                        <!-- The timeline -->
                                        <div class="timeline timeline-inverse" id="history">
                                            <!-- timeline time label -->
                                            <div class="time-label">
                                                <span class="bg-danger"> Đây sẽ là dòng thời gian </span>
                                            </div>
                                            <!-- /.timeline-label -->
                                            <!-- timeline item -->
                                            <div>
                                                <i class="fas fa-user bg-info"></i>

                                                <div class="timeline-item">
														<span class="time"><i class="far fa-clock"></i> 5
															mins ago</span>

                                                    <h3 class="timeline-header border-0">
                                                        <a href="#">Sarah Young</a> accepted your friend request
                                                    </h3>
                                                </div>
                                            </div>
                                            <!-- END timeline item -->
                                            <!-- timeline time label -->
                                            <div class="time-label">
                                                <span class="bg-success"> 1/1/1111 </span>
                                            </div>
                                            <!-- /.timeline-label -->
                                            <!-- timeline item -->
                                            <div>
                                                <i class="fas fa-camera bg-purple"></i>

                                                <div class="timeline-item">
                                                    <span class="time"><i class="far fa-clock"></i> 2 days ago</span>

                                                    <h3 class="timeline-header">
                                                        <a href="#">Mina Lee</a> uploaded new photos
                                                    </h3>

                                                    <div class="timeline-body">
                                                        <img src="https://placehold.it/150x100" alt="...">
                                                        <img src="https://placehold.it/150x100" alt="...">
                                                        <img src="https://placehold.it/150x100" alt="...">
                                                        <img src="https://placehold.it/150x100" alt="...">
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- END timeline item -->
                                            <div>
                                                <i class="far fa-clock bg-gray"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.tab-pane -->

                                    <div class="tab-pane" id="noti">
                                        <div class="timeline timeline-inverse" id="allnotifications">
                                            <!-- timeline time label -->
                                            <div class="time-label">
                                                <span class="bg-danger"> Đây sẽ là dòng thời gian tb</span>
                                            </div>
                                            <!-- /.timeline-label -->

                                        </div>
                                    </div>

                                    <div class="tab-pane" id="infomation">
                                        <form name="myForm">
                                            <div class="mb-3">
                                                <label for="shopName" class="form-label">Tên cửa hàng</label>
                                                <input ng-model="data.seller.shopName" placeholder="Nhập tên cửa hàng"
                                                       type="text" class="form-control" id="shopName" name="shopName"
                                                       ng-required="true">
                                                <div class="text-danger" ng-show="myForm.shopName.$dirty && myForm.shopName.$error.required">Vui lòng nhập tên cửa hàng</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="address" class="form-label">Địa chỉ</label>
                                                <input ng-model="data.seller.address" placeholder="Vui lòng nhập địa chỉ cửa hàng!"
                                                       type="text" class="form-control" id="address" name="address">
                                            </div>
                                            <div class="mb-3">
                                                <label for="phoneAddress" class="form-label">Số điện thoại cửa hàng</label>
                                                <input ng-model="data.seller.phoneAddress"
                                                       placeholder="Nhập số diện thoại cửa hàng" type="tel" class="form-control"
                                                       id="phoneAddress" name="phoneAddress" ng-pattern="/^0\d{9}$/">
                                                <div class="text-danger" ng-show="myForm.phoneAddress.$dirty && myForm.phoneAddress.$error.pattern">Số điện thoại không hợp lệ</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="description" class="form-label">Mô tả</label>
                                                <textarea ng-model="data.seller.description"
                                                          placeholder="Vui lòng nhập mô tả!" class="form-control" rows="3"
                                                          id="description" name="description"></textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label for="mall" class="form-check-label me-4">Shop mall</label>
                                                <input ng-model="data.seller.mall" type="checkbox"
                                                       class="form-check-input" id="mall" name="mall" disabled>
                                            </div>
    
                                            <button ng-click="updateShop()"
                                                    class="btn btn-primary" ng-disabled="myForm.$invalid">Lưu
                                            </button>
    
                                        </form>

                                        <!-- Model success save -->
                                        <button id="success" type="button" class="btn btn-primary" data-toggle="modal" data-target="#successSave" hidden>
                                            save
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="successSave" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="">
                                                            <i class="fa-solid fa-circle-exclamation text-primary"></i>
                                                            Thông báo
                                                        </h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body text-center">
                                                        <iframe src="https://lottie.host/?file=b88a887a-bdb0-4353-9bf1-6fe27e3eb9f1/FboQjv554S.json"></iframe>
                                                        <h3 class="text-center text-success">
                                                            Lưu thành công!
                                                        </h3>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-primary" data-dismiss="modal">
                                                            Chấp nhận
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End model success save -->
                                        
                                        <!-- Model false save -->
                                        <button id="false" type="button" class="btn btn-primary" data-toggle="modal" data-target="#falseSave" hidden>
                                            save
                                        </button>

                                        <!-- Modal -->
                                        <div class="modal fade" id="falseSave" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="">
                                                            <i class="fa-solid fa-circle-exclamation text-primary"></i>
                                                            Thông báo
                                                        </h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <iframe src="https://lottie.host/?file=51cd8b56-3c50-45f1-a51f-9e1ae1a50534/RwZN1jyiA0.json"></iframe>
                                                        <h3 class="text-center text-success">
                                                            Lưu Thất bại!
                                                        </h3>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-primary" data-dismiss="modal">
                                                            Chấp nhận
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End model false save -->
                                    </div>
                                    <!-- /.tab-pane -->
                                </div>
                                <!-- /.tab-content -->
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
            <!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <div th:replace="~{flagment/seller/sellerFooter :: sellerFooterFragment}"></div>
    <div th:replace="~{flagment/seller/sellerFootLink :: sellerFootLinkFragment}"></div>
</div>

<script>
    // Khi người dùng chọn ảnh, xử lý sự kiện change của input file
		document.getElementById("avatarInput").addEventListener(
			"change",
			function (event) {
				const file = event.target.files[0]; // Lấy file ảnh từ input

				if (file) {
					// Gắn tên tệp vào input ẩn có id="avatar-hide"
					document.getElementById("avatar-hide").setAttribute(
						"value", file.name);

					// (Tùy chọn) Hiển thị ảnh đã chọn lên trang web (nếu muốn)
					const reader = new FileReader();
					reader.onload = function () {
						const imageDataURL = reader.result;
						document.getElementById("avatar").setAttribute(
							"src", imageDataURL);
					};
					reader.readAsDataURL(file);
				}
			});

</script>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

<script src="/js/seller/sellerProfile.js" th:src="@{/js/seller/sellerProfile.js}"></script>
<script src="/admin/dist/js/handMade.js"></script>

<script src="/js/seller/Dwallet.js"></script>
<!-- <script src="/js/seller/sellerProfile.js"></script> -->

</html>